<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>隐藏任务 - 最终破译</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: "宋体", SimSun, serif;
            font-size: 16px;
            color: #e0e0e0;
            background-color: #121212;
            line-height: 1.6;
            padding: 0;
            margin: 0;
            min-height: 100vh;
        }

        .top-nav {
            background-color: #2a2a2a;
            color: #fff;
            padding: 12px 15px;
            border-bottom: 2px solid #555;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .nav-title {
            font-size: 1.4em;
            font-weight: bold;
            text-align: center;
            color: #d0d0d0;
        }

        .nav-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .nav-links a {
            color: #d0d0d0;
            text-decoration: none;
            font-weight: bold;
            padding: 4px 8px;
            border: 1px solid transparent;
        }

        .nav-links a:hover {
            text-decoration: underline;
            color: #fff;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid #888;
        }

        .main-content {
            width: 100%;
            margin: 0 auto;
            background-color: #1e1e1e;
            padding: 20px 15px;
            min-height: calc(100vh - 80px);
        }

        h1 {
            color: #d0d0d0;
            text-align: center;
            font-size: 1.5em;
            margin: 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px dotted #555;
        }

        .mission-info {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 30px 0;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .mission-instructions {
            padding: 15px 0;
            text-align: center;
        }

        .mission-card {
            background: #2a2a2a;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .mission-card h2 {
            color: #d0d0d0;
            margin-bottom: 15px;
        }

        .text-input-section {
            margin: 20px 0;
        }

        .password-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .password-box {
            width: 60px;
            height: 60px;
            border: 2px solid #666;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #d0d0d0;
            background-color: #1e1e1e;
            transition: all 0.3s;
        }

        .password-box.filled {
            border-color: #888;
            background-color: #2a2a2a;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.1);
        }

        .password-box.active {
            border-color: #d0d0d0;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }

        .hidden-input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .verify-btn {
            background: #666;
            color: #e0e0e0;
            padding: 10px 25px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-family: "宋体", SimSun, serif;
            font-size: 14px;
            margin: 5px;
            transition: background 0.3s;
        }

        .verify-btn:hover {
            background: #777;
        }

        .text-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 3px;
            display: none;
        }

        .text-result.success {
            background: transparent;
            color: #f5f5dc;
            display: block;
            border: 1px solid #f5f5dc;
        }

        .text-result.error {
            background: rgba(211, 47, 47, 0.2);
            color: #f44336;
            display: block;
            border: 1px solid #f44336;
        }

        .final-result {
            text-align: center;
            padding: 20px;
            background-color: #2a2a2a
        }

        .main-text {
            font-size: 1.5em;
            font-weight: bold;
            color: #fff8dc;
            margin-bottom: 10px;
        }

        .sub-text {
            color: #f5f5dc;
            font-style: italic;
        }

        .back-btn {
            background: #666;
            color: #e0e0e0;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 15px;
        }

        .back-btn:hover {
            background: #777;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 0.9em;
            color: #888;
            border-top: 1px solid #333;
            padding-top: 15px;
        }

        @media (min-width: 768px) {
            body {
                font-size: 14px;
                padding: 20px;
            }
            
            .top-nav {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 8px 20px;
                height: 60px;
            }
            
            .nav-title {
                font-size: 1.2em;
                text-align: left;
            }
            
            .nav-links {
                gap: 30px;
            }
            
            .main-content {
                width: 90%;
                max-width: 800px;
                padding: 30px;
                border: 1px solid #444;
                margin: 20px auto;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            }
            
            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="top-nav">
        <div class="nav-title">裘庄电子档案馆 - 隐藏任务</div>
        <div class="nav-links">
            <a href="secret_archive.html">返回绝密档案库</a>
            <a href="game.html">返回首页</a>
        </div>
    </div>

    <div class="main-content">
        <h1>隐藏任务 - 最终破译</h1>
        
        <div class="mission-info">
            <div class="mission-instructions">
                <p>请根据工作细则中的说明和考勤表中的线索，结合绝密档案，破译出最终的8字密文。</p>
            </div>
            
            <div class="mission-card">
                <h2>最终密文</h2>
                <p>请输入破译出的8个汉字：</p>
                <div class="text-input-section">
                    <div class="password-container" id="passwordContainer">
                        <!-- 密码框将通过JavaScript生成 -->
                    </div>
                    <input type="text" id="textInput" class="hidden-input" maxlength="8">
                    <button class="verify-btn" onclick="verifyFinalAnswer()">验证答案</button>
                </div>
                <div id="textResult" class="text-result"></div>
            </div>
        </div>

        <div class="footer">
            <p>裘庄电子档案馆 © 1999 版权所有</p>
            <p>最后更新: 1999-12-20 | 安全等级：绝密</p>
        </div>
    </div>

    <script>
        // 正确的最终答案
        const correctFinalAnswer = '密铸青史暗夜长明';
        
        // 初始化密码输入框
        function initPasswordContainer() {
            const passwordContainer = document.getElementById('passwordContainer');
            passwordContainer.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                const box = document.createElement('div');
                box.className = 'password-box';
                box.dataset.index = i;
                box.textContent = i < 4 ? '＿' : '＿'; // 使用全角下划线
                passwordContainer.appendChild(box);
            }
            
            // 添加点击事件
            document.querySelectorAll('.password-box').forEach(box => {
                box.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    focusPasswordInput(index);
                });
            });
        }
        
        // 聚焦到密码输入框的特定位置
        function focusPasswordInput(position) {
            const input = document.getElementById('textInput');
            input.focus();
            input.setSelectionRange(position, position);
            
            // 更新活动状态
            document.querySelectorAll('.password-box').forEach(box => {
                box.classList.remove('active');
            });
            document.querySelector(`.password-box[data-index="${position}"]`).classList.add('active');
        }
        
        // 更新密码显示
        function updatePasswordDisplay() {
            const input = document.getElementById('textInput');
            const value = input.value;
            const boxes = document.querySelectorAll('.password-box');
            
            boxes.forEach((box, index) => {
                if (index < value.length) {
                    box.textContent = value[index];
                    box.classList.add('filled');
                } else {
                    box.textContent = '＿';
                    box.classList.remove('filled');
                }
            });
            
            // 更新活动状态
            if (value.length < 8) {
                document.querySelectorAll('.password-box').forEach(box => {
                    box.classList.remove('active');
                });
                document.querySelector(`.password-box[data-index="${value.length}"]`).classList.add('active');
            }
        }
        
        // 验证最终答案
        function verifyFinalAnswer() {
            const textInput = document.getElementById('textInput').value.trim();
            const resultElement = document.getElementById('textResult');
            
            if (textInput.length !== 8) {
                resultElement.textContent = "请输入8个汉字";
                resultElement.className = 'text-result error';
                return;
            }
            
            if (textInput === correctFinalAnswer) {
                resultElement.className = 'text-result success';
                resultElement.innerHTML = `
                    <div class="final-result">
                        <div class="main-text">密铸青史 暗夜长明</div>
                        <div class="sub-text">—— 纪念那些在黑暗中前行的无名英雄</div>
                    </div>
                `;
                
                // 跳转到纪念页面
                setTimeout(() => {
                    window.location.href = "memorial.html";
                }, 2000);
            } else {
                resultElement.textContent = "答案不正确，请重新检查线索";
                resultElement.className = 'text-result error';
            }
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initPasswordContainer();
            
            const input = document.getElementById('textInput');
            input.addEventListener('input', updatePasswordDisplay);
            input.addEventListener('click', function() {
                // 点击输入框时，如果为空则聚焦到第一个位置
                if (this.value.length === 0) {
                    this.setSelectionRange(0, 0);
                    focusPasswordInput(0);
                }
            });
            
            // 添加键盘事件支持
            input.addEventListener('keydown', function(e) {
                // 限制只能输入汉字
                if (e.key.length === 1 && !/[\u4e00-\u9fa5]/.test(e.key)) {
                    e.preventDefault();
                }
                
                // 处理方向键
                if (e.key === 'ArrowLeft' && this.selectionStart > 0) {
                    setTimeout(() => {
                        focusPasswordInput(this.selectionStart);
                    }, 10);
                }
                if (e.key === 'ArrowRight' && this.selectionStart < this.value.length) {
                    setTimeout(() => {
                        focusPasswordInput(this.selectionStart);
                    }, 10);
                }
            });
            
            // 初始聚焦
            setTimeout(() => {
                focusPasswordInput(0);
            }, 100);
        });
    </script>
</body>
</html>